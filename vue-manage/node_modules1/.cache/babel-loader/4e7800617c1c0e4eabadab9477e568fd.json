{"ast":null,"code":"import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\n\nfunction isPattern(value) {\n  return value && (!!value.image || !!value.svgElement);\n}\n\nvar patternDomMap = new WeakMap();\n\nvar PatternManager = function (_super) {\n  __extends(PatternManager, _super);\n\n  function PatternManager(zrId, svgRoot) {\n    return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n  }\n\n  PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n    if (displayable && displayable.style) {\n      var that_1 = this;\n      zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n        var pattern = displayable.style[fillOrStroke];\n\n        if (isPattern(pattern)) {\n          var defs = that_1.getDefs(true);\n          var dom = patternDomMap.get(pattern);\n\n          if (dom) {\n            if (!defs.contains(dom)) {\n              that_1.addDom(dom);\n            }\n          } else {\n            dom = that_1.add(pattern);\n          }\n\n          that_1.markUsed(displayable);\n          var id = dom.getAttribute('id');\n          svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n        }\n      });\n    }\n  };\n\n  PatternManager.prototype.add = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n\n    var dom = this.createElement('pattern');\n    pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n    dom.setAttribute('id', 'zr' + this._zrId + '-pattern-' + pattern.id);\n    dom.setAttribute('x', '0');\n    dom.setAttribute('y', '0');\n    dom.setAttribute('patternUnits', 'userSpaceOnUse');\n    this.updateDom(pattern, dom);\n    this.addDom(dom);\n    return dom;\n  };\n\n  PatternManager.prototype.update = function (pattern) {\n    if (!isPattern(pattern)) {\n      return;\n    }\n\n    var that = this;\n    this.doUpdate(pattern, function () {\n      var dom = patternDomMap.get(pattern);\n      that.updateDom(pattern, dom);\n    });\n  };\n\n  PatternManager.prototype.updateDom = function (pattern, patternDom) {\n    var svgElement = pattern.svgElement;\n\n    if (svgElement instanceof SVGElement) {\n      if (svgElement.parentNode !== patternDom) {\n        patternDom.innerHTML = '';\n        patternDom.appendChild(svgElement);\n        patternDom.setAttribute('width', pattern.svgWidth + '');\n        patternDom.setAttribute('height', pattern.svgHeight + '');\n      }\n    } else {\n      var img = void 0;\n      var prevImage = patternDom.getElementsByTagName('image');\n\n      if (prevImage.length) {\n        if (pattern.image) {\n          img = prevImage[0];\n        } else {\n          patternDom.removeChild(prevImage[0]);\n          return;\n        }\n      } else if (pattern.image) {\n        img = this.createElement('image');\n      }\n\n      if (img) {\n        var imageSrc = void 0;\n        var patternImage = pattern.image;\n\n        if (typeof patternImage === 'string') {\n          imageSrc = patternImage;\n        } else if (patternImage instanceof HTMLImageElement) {\n          imageSrc = patternImage.src;\n        } else if (patternImage instanceof HTMLCanvasElement) {\n          imageSrc = patternImage.toDataURL();\n        }\n\n        if (imageSrc) {\n          img.setAttribute('href', imageSrc);\n          img.setAttribute('x', '0');\n          img.setAttribute('y', '0');\n          var hostEl = {\n            dirty: function () {}\n          };\n          var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n            patternDom.setAttribute('width', img.width + '');\n            patternDom.setAttribute('height', img.height + '');\n          });\n\n          if (createdImage && createdImage.width && createdImage.height) {\n            patternDom.setAttribute('width', createdImage.width + '');\n            patternDom.setAttribute('height', createdImage.height + '');\n          }\n\n          patternDom.appendChild(img);\n        }\n      }\n    }\n\n    var x = pattern.x || 0;\n    var y = pattern.y || 0;\n    var rotation = (pattern.rotation || 0) / Math.PI * 180;\n    var scaleX = pattern.scaleX || 1;\n    var scaleY = pattern.scaleY || 1;\n    var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n    patternDom.setAttribute('patternTransform', transform);\n    patternDomMap.set(pattern, patternDom);\n  };\n\n  PatternManager.prototype.markUsed = function (displayable) {\n    if (displayable.style) {\n      if (isPattern(displayable.style.fill)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n      }\n\n      if (isPattern(displayable.style.stroke)) {\n        _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n      }\n    }\n  };\n\n  return PatternManager;\n}(Definable);\n\nexport default PatternManager;","map":{"version":3,"names":["__extends","Definable","zrUtil","createOrUpdateImage","WeakMap","isPattern","value","image","svgElement","patternDomMap","PatternManager","_super","zrId","svgRoot","call","prototype","addWithoutUpdate","displayable","style","that_1","each","fillOrStroke","pattern","defs","getDefs","dom","get","contains","addDom","add","markUsed","id","getAttribute","setAttribute","createElement","nextId","_zrId","updateDom","update","that","doUpdate","patternDom","SVGElement","parentNode","innerHTML","appendChild","svgWidth","svgHeight","img","prevImage","getElementsByTagName","length","removeChild","imageSrc","patternImage","HTMLImageElement","src","HTMLCanvasElement","toDataURL","hostEl","dirty","createdImage","width","height","x","y","rotation","Math","PI","scaleX","scaleY","transform","set","fill","markDomUsed","stroke"],"sources":["E:/school/qianduan/web/vue-manage/node_modules/zrender/lib/svg/helper/PatternManager.js"],"sourcesContent":["import { __extends } from \"tslib\";\nimport Definable from './Definable';\nimport * as zrUtil from '../../core/util';\nimport { createOrUpdateImage } from '../../graphic/helper/image';\nimport WeakMap from '../../core/WeakMap';\nfunction isPattern(value) {\n    return value && (!!value.image || !!value.svgElement);\n}\nvar patternDomMap = new WeakMap();\nvar PatternManager = (function (_super) {\n    __extends(PatternManager, _super);\n    function PatternManager(zrId, svgRoot) {\n        return _super.call(this, zrId, svgRoot, ['pattern'], '__pattern_in_use__') || this;\n    }\n    PatternManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n        if (displayable && displayable.style) {\n            var that_1 = this;\n            zrUtil.each(['fill', 'stroke'], function (fillOrStroke) {\n                var pattern = displayable.style[fillOrStroke];\n                if (isPattern(pattern)) {\n                    var defs = that_1.getDefs(true);\n                    var dom = patternDomMap.get(pattern);\n                    if (dom) {\n                        if (!defs.contains(dom)) {\n                            that_1.addDom(dom);\n                        }\n                    }\n                    else {\n                        dom = that_1.add(pattern);\n                    }\n                    that_1.markUsed(displayable);\n                    var id = dom.getAttribute('id');\n                    svgElement.setAttribute(fillOrStroke, 'url(#' + id + ')');\n                }\n            });\n        }\n    };\n    PatternManager.prototype.add = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var dom = this.createElement('pattern');\n        pattern.id = pattern.id == null ? this.nextId++ : pattern.id;\n        dom.setAttribute('id', 'zr' + this._zrId\n            + '-pattern-' + pattern.id);\n        dom.setAttribute('x', '0');\n        dom.setAttribute('y', '0');\n        dom.setAttribute('patternUnits', 'userSpaceOnUse');\n        this.updateDom(pattern, dom);\n        this.addDom(dom);\n        return dom;\n    };\n    PatternManager.prototype.update = function (pattern) {\n        if (!isPattern(pattern)) {\n            return;\n        }\n        var that = this;\n        this.doUpdate(pattern, function () {\n            var dom = patternDomMap.get(pattern);\n            that.updateDom(pattern, dom);\n        });\n    };\n    PatternManager.prototype.updateDom = function (pattern, patternDom) {\n        var svgElement = pattern.svgElement;\n        if (svgElement instanceof SVGElement) {\n            if (svgElement.parentNode !== patternDom) {\n                patternDom.innerHTML = '';\n                patternDom.appendChild(svgElement);\n                patternDom.setAttribute('width', pattern.svgWidth + '');\n                patternDom.setAttribute('height', pattern.svgHeight + '');\n            }\n        }\n        else {\n            var img = void 0;\n            var prevImage = patternDom.getElementsByTagName('image');\n            if (prevImage.length) {\n                if (pattern.image) {\n                    img = prevImage[0];\n                }\n                else {\n                    patternDom.removeChild(prevImage[0]);\n                    return;\n                }\n            }\n            else if (pattern.image) {\n                img = this.createElement('image');\n            }\n            if (img) {\n                var imageSrc = void 0;\n                var patternImage = pattern.image;\n                if (typeof patternImage === 'string') {\n                    imageSrc = patternImage;\n                }\n                else if (patternImage instanceof HTMLImageElement) {\n                    imageSrc = patternImage.src;\n                }\n                else if (patternImage instanceof HTMLCanvasElement) {\n                    imageSrc = patternImage.toDataURL();\n                }\n                if (imageSrc) {\n                    img.setAttribute('href', imageSrc);\n                    img.setAttribute('x', '0');\n                    img.setAttribute('y', '0');\n                    var hostEl = {\n                        dirty: function () { }\n                    };\n                    var createdImage = createOrUpdateImage(imageSrc, img, hostEl, function (img) {\n                        patternDom.setAttribute('width', img.width + '');\n                        patternDom.setAttribute('height', img.height + '');\n                    });\n                    if (createdImage && createdImage.width && createdImage.height) {\n                        patternDom.setAttribute('width', createdImage.width + '');\n                        patternDom.setAttribute('height', createdImage.height + '');\n                    }\n                    patternDom.appendChild(img);\n                }\n            }\n        }\n        var x = pattern.x || 0;\n        var y = pattern.y || 0;\n        var rotation = (pattern.rotation || 0) / Math.PI * 180;\n        var scaleX = pattern.scaleX || 1;\n        var scaleY = pattern.scaleY || 1;\n        var transform = \"translate(\" + x + \", \" + y + \") rotate(\" + rotation + \") scale(\" + scaleX + \", \" + scaleY + \")\";\n        patternDom.setAttribute('patternTransform', transform);\n        patternDomMap.set(pattern, patternDom);\n    };\n    PatternManager.prototype.markUsed = function (displayable) {\n        if (displayable.style) {\n            if (isPattern(displayable.style.fill)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.fill));\n            }\n            if (isPattern(displayable.style.stroke)) {\n                _super.prototype.markDomUsed.call(this, patternDomMap.get(displayable.style.stroke));\n            }\n        }\n    };\n    return PatternManager;\n}(Definable));\nexport default PatternManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import * as util from './core/util';\nimport env from './core/env';\nimport timsort from './core/timsort';\nimport { REDARAW_BIT } from './graphic/constants';\nvar invalidZErrorLogged = false;\n\nfunction logInvalidZError() {\n  if (invalidZErrorLogged) {\n    return;\n  }\n\n  invalidZErrorLogged = true;\n  console.warn('z / z2 / zlevel of displayable is invalid, which may cause unexpected errors');\n}\n\nfunction shapeCompareFunc(a, b) {\n  if (a.zlevel === b.zlevel) {\n    if (a.z === b.z) {\n      return a.z2 - b.z2;\n    }\n\n    return a.z - b.z;\n  }\n\n  return a.zlevel - b.zlevel;\n}\n\nvar Storage = function () {\n  function Storage() {\n    this._roots = [];\n    this._displayList = [];\n    this._displayListLen = 0;\n    this.displayableSortFunc = shapeCompareFunc;\n  }\n\n  Storage.prototype.traverse = function (cb, context) {\n    for (var i = 0; i < this._roots.length; i++) {\n      this._roots[i].traverse(cb, context);\n    }\n  };\n\n  Storage.prototype.getDisplayList = function (update, includeIgnore) {\n    includeIgnore = includeIgnore || false;\n    var displayList = this._displayList;\n\n    if (update || !displayList.length) {\n      this.updateDisplayList(includeIgnore);\n    }\n\n    return displayList;\n  };\n\n  Storage.prototype.updateDisplayList = function (includeIgnore) {\n    this._displayListLen = 0;\n    var roots = this._roots;\n    var displayList = this._displayList;\n\n    for (var i = 0, len = roots.length; i < len; i++) {\n      this._updateAndAddDisplayable(roots[i], null, includeIgnore);\n    }\n\n    displayList.length = this._displayListLen;\n    env.canvasSupported && timsort(displayList, shapeCompareFunc);\n  };\n\n  Storage.prototype._updateAndAddDisplayable = function (el, clipPaths, includeIgnore) {\n    if (el.ignore && !includeIgnore) {\n      return;\n    }\n\n    el.beforeUpdate();\n    el.update();\n    el.afterUpdate();\n    var userSetClipPath = el.getClipPath();\n\n    if (el.ignoreClip) {\n      clipPaths = null;\n    } else if (userSetClipPath) {\n      if (clipPaths) {\n        clipPaths = clipPaths.slice();\n      } else {\n        clipPaths = [];\n      }\n\n      var currentClipPath = userSetClipPath;\n      var parentClipPath = el;\n\n      while (currentClipPath) {\n        currentClipPath.parent = parentClipPath;\n        currentClipPath.updateTransform();\n        clipPaths.push(currentClipPath);\n        parentClipPath = currentClipPath;\n        currentClipPath = currentClipPath.getClipPath();\n      }\n    }\n\n    if (el.childrenRef) {\n      var children = el.childrenRef();\n\n      for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n\n        if (el.__dirty) {\n          child.__dirty |= REDARAW_BIT;\n        }\n\n        this._updateAndAddDisplayable(child, clipPaths, includeIgnore);\n      }\n\n      el.__dirty = 0;\n    } else {\n      var disp = el;\n\n      if (clipPaths && clipPaths.length) {\n        disp.__clipPaths = clipPaths;\n      } else if (disp.__clipPaths && disp.__clipPaths.length > 0) {\n        disp.__clipPaths = [];\n      }\n\n      if (isNaN(disp.z)) {\n        logInvalidZError();\n        disp.z = 0;\n      }\n\n      if (isNaN(disp.z2)) {\n        logInvalidZError();\n        disp.z2 = 0;\n      }\n\n      if (isNaN(disp.zlevel)) {\n        logInvalidZError();\n        disp.zlevel = 0;\n      }\n\n      this._displayList[this._displayListLen++] = disp;\n    }\n\n    var decalEl = el.getDecalElement && el.getDecalElement();\n\n    if (decalEl) {\n      this._updateAndAddDisplayable(decalEl, clipPaths, includeIgnore);\n    }\n\n    var textGuide = el.getTextGuideLine();\n\n    if (textGuide) {\n      this._updateAndAddDisplayable(textGuide, clipPaths, includeIgnore);\n    }\n\n    var textEl = el.getTextContent();\n\n    if (textEl) {\n      this._updateAndAddDisplayable(textEl, clipPaths, includeIgnore);\n    }\n  };\n\n  Storage.prototype.addRoot = function (el) {\n    if (el.__zr && el.__zr.storage === this) {\n      return;\n    }\n\n    this._roots.push(el);\n  };\n\n  Storage.prototype.delRoot = function (el) {\n    if (el instanceof Array) {\n      for (var i = 0, l = el.length; i < l; i++) {\n        this.delRoot(el[i]);\n      }\n\n      return;\n    }\n\n    var idx = util.indexOf(this._roots, el);\n\n    if (idx >= 0) {\n      this._roots.splice(idx, 1);\n    }\n  };\n\n  Storage.prototype.delAllRoots = function () {\n    this._roots = [];\n    this._displayList = [];\n    this._displayListLen = 0;\n    return;\n  };\n\n  Storage.prototype.getRoots = function () {\n    return this._roots;\n  };\n\n  Storage.prototype.dispose = function () {\n    this._displayList = null;\n    this._roots = null;\n  };\n\n  return Storage;\n}();\n\nexport default Storage;","map":{"version":3,"names":["util","env","timsort","REDARAW_BIT","invalidZErrorLogged","logInvalidZError","console","warn","shapeCompareFunc","a","b","zlevel","z","z2","Storage","_roots","_displayList","_displayListLen","displayableSortFunc","prototype","traverse","cb","context","i","length","getDisplayList","update","includeIgnore","displayList","updateDisplayList","roots","len","_updateAndAddDisplayable","canvasSupported","el","clipPaths","ignore","beforeUpdate","afterUpdate","userSetClipPath","getClipPath","ignoreClip","slice","currentClipPath","parentClipPath","parent","updateTransform","push","childrenRef","children","child","__dirty","disp","__clipPaths","isNaN","decalEl","getDecalElement","textGuide","getTextGuideLine","textEl","getTextContent","addRoot","__zr","storage","delRoot","Array","l","idx","indexOf","splice","delAllRoots","getRoots","dispose"],"sources":["E:/school/qianduan/web/vue-manage/node_modules/zrender/lib/Storage.js"],"sourcesContent":["import * as util from './core/util';\nimport env from './core/env';\nimport timsort from './core/timsort';\nimport { REDARAW_BIT } from './graphic/constants';\nvar invalidZErrorLogged = false;\nfunction logInvalidZError() {\n    if (invalidZErrorLogged) {\n        return;\n    }\n    invalidZErrorLogged = true;\n    console.warn('z / z2 / zlevel of displayable is invalid, which may cause unexpected errors');\n}\nfunction shapeCompareFunc(a, b) {\n    if (a.zlevel === b.zlevel) {\n        if (a.z === b.z) {\n            return a.z2 - b.z2;\n        }\n        return a.z - b.z;\n    }\n    return a.zlevel - b.zlevel;\n}\nvar Storage = (function () {\n    function Storage() {\n        this._roots = [];\n        this._displayList = [];\n        this._displayListLen = 0;\n        this.displayableSortFunc = shapeCompareFunc;\n    }\n    Storage.prototype.traverse = function (cb, context) {\n        for (var i = 0; i < this._roots.length; i++) {\n            this._roots[i].traverse(cb, context);\n        }\n    };\n    Storage.prototype.getDisplayList = function (update, includeIgnore) {\n        includeIgnore = includeIgnore || false;\n        var displayList = this._displayList;\n        if (update || !displayList.length) {\n            this.updateDisplayList(includeIgnore);\n        }\n        return displayList;\n    };\n    Storage.prototype.updateDisplayList = function (includeIgnore) {\n        this._displayListLen = 0;\n        var roots = this._roots;\n        var displayList = this._displayList;\n        for (var i = 0, len = roots.length; i < len; i++) {\n            this._updateAndAddDisplayable(roots[i], null, includeIgnore);\n        }\n        displayList.length = this._displayListLen;\n        env.canvasSupported && timsort(displayList, shapeCompareFunc);\n    };\n    Storage.prototype._updateAndAddDisplayable = function (el, clipPaths, includeIgnore) {\n        if (el.ignore && !includeIgnore) {\n            return;\n        }\n        el.beforeUpdate();\n        el.update();\n        el.afterUpdate();\n        var userSetClipPath = el.getClipPath();\n        if (el.ignoreClip) {\n            clipPaths = null;\n        }\n        else if (userSetClipPath) {\n            if (clipPaths) {\n                clipPaths = clipPaths.slice();\n            }\n            else {\n                clipPaths = [];\n            }\n            var currentClipPath = userSetClipPath;\n            var parentClipPath = el;\n            while (currentClipPath) {\n                currentClipPath.parent = parentClipPath;\n                currentClipPath.updateTransform();\n                clipPaths.push(currentClipPath);\n                parentClipPath = currentClipPath;\n                currentClipPath = currentClipPath.getClipPath();\n            }\n        }\n        if (el.childrenRef) {\n            var children = el.childrenRef();\n            for (var i = 0; i < children.length; i++) {\n                var child = children[i];\n                if (el.__dirty) {\n                    child.__dirty |= REDARAW_BIT;\n                }\n                this._updateAndAddDisplayable(child, clipPaths, includeIgnore);\n            }\n            el.__dirty = 0;\n        }\n        else {\n            var disp = el;\n            if (clipPaths && clipPaths.length) {\n                disp.__clipPaths = clipPaths;\n            }\n            else if (disp.__clipPaths && disp.__clipPaths.length > 0) {\n                disp.__clipPaths = [];\n            }\n            if (isNaN(disp.z)) {\n                logInvalidZError();\n                disp.z = 0;\n            }\n            if (isNaN(disp.z2)) {\n                logInvalidZError();\n                disp.z2 = 0;\n            }\n            if (isNaN(disp.zlevel)) {\n                logInvalidZError();\n                disp.zlevel = 0;\n            }\n            this._displayList[this._displayListLen++] = disp;\n        }\n        var decalEl = el.getDecalElement && el.getDecalElement();\n        if (decalEl) {\n            this._updateAndAddDisplayable(decalEl, clipPaths, includeIgnore);\n        }\n        var textGuide = el.getTextGuideLine();\n        if (textGuide) {\n            this._updateAndAddDisplayable(textGuide, clipPaths, includeIgnore);\n        }\n        var textEl = el.getTextContent();\n        if (textEl) {\n            this._updateAndAddDisplayable(textEl, clipPaths, includeIgnore);\n        }\n    };\n    Storage.prototype.addRoot = function (el) {\n        if (el.__zr && el.__zr.storage === this) {\n            return;\n        }\n        this._roots.push(el);\n    };\n    Storage.prototype.delRoot = function (el) {\n        if (el instanceof Array) {\n            for (var i = 0, l = el.length; i < l; i++) {\n                this.delRoot(el[i]);\n            }\n            return;\n        }\n        var idx = util.indexOf(this._roots, el);\n        if (idx >= 0) {\n            this._roots.splice(idx, 1);\n        }\n    };\n    Storage.prototype.delAllRoots = function () {\n        this._roots = [];\n        this._displayList = [];\n        this._displayListLen = 0;\n        return;\n    };\n    Storage.prototype.getRoots = function () {\n        return this._roots;\n    };\n    Storage.prototype.dispose = function () {\n        this._displayList = null;\n        this._roots = null;\n    };\n    return Storage;\n}());\nexport default Storage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}